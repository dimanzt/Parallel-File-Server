<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="ProgId" content="Word.Document">
<meta name="Generator" content="Microsoft Word 11">
<meta name="Originator" content="Microsoft Word 11">
<link rel="File-List" href="http://www.cse.psu.edu/%7Eanand/511/p2/proj2_new_files/filelist.xml">
<link rel="Edit-Time-Data" href="http://www.cse.psu.edu/%7Eanand/511/p2/proj2_new_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title> CSE 511 </title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Aravindhan Venkateswaran</o:Author>
  <o:LastAuthor>Aravindhan Venkateswaran</o:LastAuthor>
  <o:Revision>31</o:Revision>
  <o:TotalTime>27</o:TotalTime>
  <o:Created>2005-10-28T20:49:00Z</o:Created>
  <o:LastSaved>2005-12-10T04:22:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1324</o:Words>
  <o:Characters>7552</o:Characters>
  <o:Company> psu</o:Company>
  <o:Lines>62</o:Lines>
  <o:Paragraphs>17</o:Paragraphs>
  <o:CharactersWithSpaces>8859</o:CharactersWithSpaces>
  <o:Version>11.6408</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>114</w:Zoom>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:3 0 0 0 1 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:23482265;
	mso-list-type:hybrid;
	mso-list-template-ids:-409827568 -1195595146 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-start-at:0;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@list l0:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1
	{mso-list-id:900023996;
	mso-list-type:hybrid;
	mso-list-template-ids:-1434262734 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2
	{mso-list-id:1131825797;
	mso-list-type:hybrid;
	mso-list-template-ids:526299542 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l2:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3
	{mso-list-id:1760322749;
	mso-list-type:hybrid;
	mso-list-template-ids:-1918456478 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l3:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="15362"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body style="tab-interval:.5in" bgcolor="white" lang="EN-US" link="blue" vlink="blue">

<div class="Section1">

<h3 style="margin-left:.5in;text-align:center" align="center">Project 2: A Simple
Parallel File System</h3>

<p class="MsoNormal" style="margin-left:.5in;text-align:center" align="center"><b><span style="color:sienna">( due on December 11)</span></b></p>

<p><span style="mso-spacerun:yes">&nbsp;</span></p>

<div class="MsoNormal" style="text-align:center" align="center">

<hr align="center" size="2" width="100%">

</div>

<p><span style="font-size:11.0pt">(<a href="http://www.cse.psu.edu/%7Eanand/511/p2/proj2.pdf">Click here for a pdf
version of the project description</a>)<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="mso-spacerun:yes">&nbsp;</span>In this project, your will implement a simple Parallel
File System (PFS) which provides access to file data for parallel applications.
The figure in the PDF file gives an overview of PFS and its components.</p>

<p>
</p><p class="MsoNormal" style="text-align:justify">Like most other files systems,
the PFS is also designed as client-server architecture with multiple servers
which typically run on separate nodes and have disks attached to them. Each
file in the PFS system is striped across the disks on the file servers and the
application processes interact with the file system using a client library. The
PFS also has a Metadata Manager which handles all the metadata associated with
files. The Metadata Manager does not take part in the actual read/write
operations. The client, file servers and the metadata manager need not run on
different machines though running them on different machines generally results
in higher performance. </p>

<p class="MsoNormal" style="text-align:justify"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="text-align:justify">As part of your project, you will
be implementing all the four primary components of a simple PFS:</p>

<ol style="margin-top:0in" start="1" type="1">
 <li class="MsoNormal" style="text-align:justify;mso-list:l2 level1 lfo2;
     tab-stops:list .5in">Metadata Manager</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l2 level1 lfo2;
     tab-stops:list .5in">File Servers</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l2 level1 lfo2;
     tab-stops:list .5in">Client</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l2 level1 lfo2;
     tab-stops:list .5in">Client Cache</li>
</ol>

<p class="MsoNormal" style="text-align:justify">A brief description of all the
components is given below.</p>

<p class="MsoNormal" style="text-align:justify"><b style="mso-bidi-font-weight:
normal">Metadata Manager<o:p></o:p></b></p>

<p class="MsoNormal" style="text-align:justify">The metadata manager is responsible
for the storage and maintaining all the metadata associated with a file. For
this project, we will assume a flat file system consisting of only one root
directory. For all the files in the directory, you need to maintain the
following metadata:</p>

<ol style="margin-top:0in" start="1" type="1">
 <li class="MsoNormal" style="text-align:justify;mso-list:l1 level1 lfo3;
     tab-stops:list .5in">Filename</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l1 level1 lfo3;
     tab-stops:list .5in">File size</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l1 level1 lfo3;
     tab-stops:list .5in">Time of creation</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l1 level1 lfo3;
     tab-stops:list .5in">Time of last modification</li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l1 level1 lfo3;
     tab-stops:list .5in">File recipe</li>
</ol>

<p class="MsoNormal" style="text-align:justify">Note that a given file in the PFS
is striped across various file servers to facilitate parallel access. The
specifics of this file distribution are described by what is known as the <i style="mso-bidi-font-style:normal">file recipe</i>. You are free to abstract
out the components of a file recipe as part of your system design. Note that
the <i style="mso-bidi-font-style:normal">block size</i> and the <i style="mso-bidi-font-style:normal">stripe size</i> will be a fixed value which
will be provided to you as part of a configuration file. The <i style="mso-bidi-font-style:normal">stripe width</i> which defines how many
nodes the file will be split across, will be specified by the user when the
file is created. When a client opens a file, the metadata manager returns to
the client the file recipe. Thus the client directly communicates to the file
servers to access file data.</p>

<p class="MsoNormal" style="text-align:justify"><b style="mso-bidi-font-weight:
normal">Token Management <o:p></o:p></b></p>

<p class="MsoNormal" style="text-align:justify">The metadata manager also
performs the task of a token manager for ensuring consistency in the system.
The goal here is to guarantee single-node equivalent POSIX/UNIX consistency for
file system operations across the system. Every file system operation acquires
an appropriate read or write lock to synchronize with conflicting operations on
other nodes before reading or updating any file system data. For this project,
you need to implement block-range locking in order to allow parallel
applications to write concurrently to different blocks of the same file. The
token manager coordinates locks by handing out <i style="mso-bidi-font-style:
normal">lock tokens</i>. There are two types of lock tokens that are issued by
the token manager: <i style="mso-bidi-font-style:normal">read tokens</i> and <i style="mso-bidi-font-style:normal">write tokens</i>. Multiple nodes can
simultaneously acquire read tokens for the same file-block. However,
block-range tokens for parallel writes are negotiated as follows. The first
node to read/write a file acquires the block-range token for the whole file
(zero to infinity). As long as no other nodes require access to the same file,
all read and write operations are processed locally. When a second node begins
writing to the same file it will need to revoke at least part of the
block-range token held by the first node. When the first node receives a revoke
request, it checks whether the file is still in use. If the file has since been
closed, the first node will give up the whole token, and the second node will
then be able to acquire a token covering the whole file. On the other hand, if
the second node starts writing to a file before the first node closes the file,
the first node will relinquish only part of its block-range token. If the first
node is writing sequentially at offset o<sub>1</sub> and the second node at
offset o<sub>2</sub>, the first node will relinquish its token from o<sub>2</sub>
to infinity (if o<sub>2</sub> &gt; o<sub>1</sub>) or from zero to o<sub>1</sub>
(if o<sub>2</sub> &lt; o<sub>1</sub>).</p>

<p class="MsoNormal" style="text-align:justify"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="text-align:justify"><b style="mso-bidi-font-weight:
normal">File Servers<o:p></o:p></b></p>

<p class="MsoNormal" style="text-align:justify">There are a fixed number of file
servers in the network which will be also be specified in the configuration
file provided to you. Every file in the PFS is striped across a number of these
file servers. You can simulate file striping by implementing each stripe using
the native file system in the file servers. </p>

<p class="MsoNormal" style="text-align:justify"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="text-align:justify"><b style="mso-bidi-font-weight:
normal">PFS Client<o:p></o:p></b></p>

<p class="MsoNormal" style="text-align:justify">The following file system
interfaces needs to be implemented by the PFS Client</p>

<p class="MsoNormal" style="text-align:justify"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">int pfs_create(const char *filename, int stripe_width);<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">int pfs_open(const char *filename, const char mode);<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">ssize_t pfs_read(int filedes, void *buf, ssize_t nbyte,
off_t offset, int *cache_hit);<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">ssize_t pfs_write(int filedes, const void *buf, size_t
nbyte, off_t offset, int *cache_hit);<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">int pfs_close(int filedes);<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">int pfs_delete(const char *filename);<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><span style="font-size:10.0pt;
font-family:Courier">int pfs_fstat(int filedes, struct pfs_stat *buf); // Check
the config file for the definition of pfs_stat structure<o:p></o:p></span></p>

<p class="MsoNormal" style="text-align:justify"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="text-align:justify"><b style="mso-bidi-font-weight:
normal">Client Cache<o:p></o:p></b></p>

<p class="MsoNormal" style="text-align:justify">The PFS uses local cache on each
client having a default size of 2 MB. The client cache consists of (1) free
space and (2) used space. The used space in the client cache can further be
divided into blocks that have been modified (i.e. dirty blocks which have not
been flushed to the server yet) or not. As part of the cache management scheme,
you need to implement the following two threads:</p>

<ol style="margin-top:0in" start="1" type="1">
 <li class="MsoNormal" style="text-align:justify;mso-list:l3 level1 lfo4;
     tab-stops:list .5in">Harvesters Thread: The job of the harvester thread is
     to maintain sufficient amount of free space in the client cache. Whenever
     the free space falls below a specific lower threshold, the harvester
     thread frees up memory from the used space based on an LRU policy till the
     amount of free space reaches an upper threshold. </li>
 <li class="MsoNormal" style="text-align:justify;mso-list:l3 level1 lfo4;
     tab-stops:list .5in">Flusher Thread: The job of the flusher thread is to periodically
     (every 30 seconds) flush all the dirty blocks (modified blocks) back to
     the appropriate file servers.</li>
</ol>

<p class="MsoNormal" style="text-align:justify">Note that you will have to
implement a hashing scheme to map and look up the file blocks onto the cache.</p>

<p class="MsoNormal" style="text-align:justify"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="text-align:justify">If the client has the appropriate
tokens, and a read/write call issued by the client results in a cache hit, the
operations should be performed on locally on the client cache. On the other
hand, whenever there is a cache miss, the blocks need to be fetched from the
file server which will then be cached locally on the client using the available
free space. The client returns the information about a cache hit or miss for
every read/write call using the Boolean argument <span style="font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Courier">cache_hit</span> which is passed
as a parameter to both the <span style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:Courier">pfs_read()</span> and <span style="font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Courier">pfs_write()</span>function
calls. If the client needs to acquire fresh tokens from the token manager for a
read/write call, the file data need to be fetched from the file servers.
Whenever a client is required to relinquish a part of its token, it needs to
flush the dirty blocks to the file servers before relinquishing the tokens to
the token manager. </p>

<p class="MsoNormal" style="text-align:justify"><span style="mso-spacerun:yes">&nbsp;</span></p>

<p class="MsoNormal" style="text-align:justify"><b style="mso-bidi-font-weight:
normal">Implementation Notes<o:p></o:p></b></p>

<p class="MsoNormal" style="text-align:justify">You can use pthreads library and
socket APIs. Note that all the communication between various nodes in the
system needs to be implemented using sockets. Here is a <a href="http://www.cse.psu.edu/%7Eanand/511/p2/config.h">sample
configuration file</a> which list the default values for various constants.
Also, note that you do not need to worry about issues related to
fault-tolerance and reliability. 
</p>

<p style="text-align:justify">The project reports are due in class on the
designated day (no extensions will be given) and the programs should be turned
in before midnight on that day using the turn-in procedure. 
You can work in
teams (atmost 2 people per team) for the project. You are free to choose your
partner but if either of you choose to drop out of your team for any reason at
any time, each of you will be individually responsible for implementing and
demonstrating the entire project and writing the project report by the
designated deadline. Even though you will work in pairs, each of you should be
fully familiar with the entire code and be prepared to answer a range of
questions related to the entire project. It will be a good idea to work
together at least during the initial design of the code. You should also ensure
that there is a fair division of labor between the members. Also, give a detailed
description of your implementation justifying any reasonable assumptions you
may have made in the final report. </p>

<h2><a href="http://www.cse.psu.edu/%7Eanand/511/p2/faq.html" target="_self">FAQ</a></h2>

<h2><a href="http://www.cse.psu.edu/%7Eanand/511/p2/p2_test.tar">Test Files</a></h2>

<h3><o:p>&nbsp;</o:p></h3>

<h3>Useful Links</h3>

<p class="MsoNormal"><span style="font-family:Symbol;mso-ascii-font-family:&quot;Times New Roman&quot;">·</span><span style="mso-spacerun:yes">&nbsp; </span><a href="http://www.almaden.ibm.com/StorageSystems/file_systems/GPFS/Fast02.pdf" target="_blank">The General Parallel File System</a></p>

</div>




</body></html>